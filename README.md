# Assignment_7_Cardoc ğŸš—

**wanted x wecode í”„ë¦¬ì˜¨ë³´ë”© ë°±ì—”ë“œ ì½”ìŠ¤ - [Assignment 7] ì¹´ë‹¥**

- ì¼ì •: 2021ë…„ 11ì›” 22ì¼(ì›”) ì˜¤í›„ 4ì‹œ ~ 11ì›” 29ì¼(ì›”) ì˜¤í›„ 2ì‹œ

</br>

## Contributor ğŸ’»

|            [ê¹€ë°”ë‹¤](https://github.com/sally0226)            |
| :----------------------------------------------------------: |
| <img src="https://avatars.githubusercontent.com/u/43634786?v=4" alt="profile_image" width="150px" /> |
|                             TIL                              |
| [resume](https://befitting-tapir-064.notion.site/Resume-8a9cf8a92ef64f79a04be5d98ce9719c) |

</br>

## ë°°í¬ ì£¼ì†Œ ğŸŒ

ì£¼ì†Œ : http://101.101.211.247:3000

</br>

## í”„ë¡œì íŠ¸ ì‹¤í–‰ ë°©ë²• (in local) ğŸƒ

* node, npmì´ ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ëŠ” ê°€ì •í•˜ì— ì‘ì„±ëœ ê°€ì´ë“œì…ë‹ˆë‹¤.

> ì´ í”„ë¡œì íŠ¸ì— ì‚¬ìš©ëœ ë²„ì „
>
> node : v14.18.0
>
> npm : 6.14.15

1. git cloneì„ í†µí•´ ì½”ë“œë¥¼ ë‚´ë ¤ë°›ìŠµë‹ˆë‹¤.

   ```shell
   $ git clone https://github.com/sally0226/assignment-7-cardoc.git
   ```

2. nestê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš°, nestë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

   ```shell
   $ npm i -g @nestjs/cli
   ```

3. íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

   ```shell
   $ npm install
   ```

4. `.env`ë¥¼ ì‘ì„±í•´ì¤ë‹ˆë‹¤.

   [.env ë‚´ìš©](https://befitting-tapir-064.notion.site/env-fa0933485cd94a9baeb5432a9dfe3d0b)

5. ì„œë²„ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

   ```shell
   $ npm start
   ```

   í•´ë‹¹ ëª…ë ¹ì–´ê°€ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´, http://localhost:3000ê°€ ì—´ë¦½ë‹ˆë‹¤.

5. ì›í•˜ëŠ” APIì— ì ‘ê·¼í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•©ë‹ˆë‹¤. 

</br>

## ê³¼ì œ ìš”êµ¬ì‚¬í•­ ğŸ“

**âœ”ï¸ ì‚¬ìš©ì ìƒì„± API** 

**âœ”ï¸ ë¡œê·¸ì¸ API** 

**âœ”ï¸ ì‚¬ìš©ìê°€ ì†Œìœ í•œ íƒ€ì´ì–´ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” API**

**âœ”ï¸ ì‚¬ìš©ìê°€ ì†Œìœ í•œ íƒ€ì´ì–´ ì •ë³´ ì¡°íšŒ API**

</br>

ğŸ“Œ RDBì¤‘ Mysql ì‚¬ìš©

> local DBê°€ ì•„ë‹Œ dockerë¡œ ë°°í¬í•œ Mysql ì„œë²„ ì´ìš©

ğŸ“Œ TypeORM ì´ìš©

ğŸ“Œ Dockerë¥¼ ì´ìš©í•œ ë°°í¬

</br>

## ERD ğŸ§¬

![image](https://user-images.githubusercontent.com/43634786/143771397-f7101d47-69ec-4482-80ed-878a1af2ade4.png)

</br>

## ì‚¬ìš© ê¸°ìˆ  ğŸŒ 

- Backend : [![img](https://camo.githubusercontent.com/cb0c26ab83b212946400b29c325debd89d07f0c36e3568c840dc6ae07127ca1b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4e6573744a532d4530323334453f7374796c653d666c6174266c6f676f3d4e6573744a53266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/cb0c26ab83b212946400b29c325debd89d07f0c36e3568c840dc6ae07127ca1b/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4e6573744a532d4530323334453f7374796c653d666c6174266c6f676f3d4e6573744a53266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/17131306fc490286432e1148ea92ac1754363621a9d185bf613ad6e0f4d33a96/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f547970655363726970742d3331373843363f7374796c653d666c6174266c6f676f3d54797065536372697074266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/17131306fc490286432e1148ea92ac1754363621a9d185bf613ad6e0f4d33a96/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f547970655363726970742d3331373843363f7374796c653d666c6174266c6f676f3d54797065536372697074266c6f676f436f6c6f723d7768697465)
- DataBase : [![img](https://camo.githubusercontent.com/779f9a01c244fb737d351d3256288537428012c3cc755e70e7c5663afc1b7c01/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4d7953514c2d3434373941313f7374796c653d666c6174266c6f676f3d4d7953514c266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/779f9a01c244fb737d351d3256288537428012c3cc755e70e7c5663afc1b7c01/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4d7953514c2d3434373941313f7374796c653d666c6174266c6f676f3d4d7953514c266c6f676f436f6c6f723d7768697465)
- Collaboration : [![img](https://camo.githubusercontent.com/493683d1e69c600dc04bb375ab588466c554471ea28f7326b390b5103c401058/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769742d4630353033323f7374796c653d666c6174266c6f676f3d476974266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/493683d1e69c600dc04bb375ab588466c554471ea28f7326b390b5103c401058/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769742d4630353033323f7374796c653d666c6174266c6f676f3d476974266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/779ecf5e6059fd906fca2099015186945f91679f22da6bf05f37f52e69e86e8a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769744875622d3138313731373f7374796c653d666c6174266c6f676f3d476974487562266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/779ecf5e6059fd906fca2099015186945f91679f22da6bf05f37f52e69e86e8a/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4769744875622d3138313731373f7374796c653d666c6174266c6f676f3d476974487562266c6f676f436f6c6f723d7768697465) [![img](https://camo.githubusercontent.com/1b756736e374960a174cb6f65083804b2052cd6f6e997af84206794e2ca77f71/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f506f73746d616e2d4646364333373f7374796c653d666c6174266c6f676f3d506f73746d616e266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/1b756736e374960a174cb6f65083804b2052cd6f6e997af84206794e2ca77f71/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f506f73746d616e2d4646364333373f7374796c653d666c6174266c6f676f3d506f73746d616e266c6f676f436f6c6f723d7768697465)
- Deploy: [![img](https://camo.githubusercontent.com/b59f4ce8eeb9bdf7a12c2008d3ebf470c640935689650f6f4a864d1c8bda1564/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4e6176657220436c6f75642d3033433735413f7374796c653d666c6174266c6f676f3d4e61766572266c6f676f436f6c6f723d7768697465)](https://camo.githubusercontent.com/b59f4ce8eeb9bdf7a12c2008d3ebf470c640935689650f6f4a864d1c8bda1564/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f4e6176657220436c6f75642d3033433735413f7374796c653d666c6174266c6f676f3d4e61766572266c6f676f436f6c6f723d7768697465) <img src="https://img.shields.io/badge/Docker-2496ED?style=flat&logo=Docker&logoColor=white"/>

</br>

## êµ¬í˜„ ë°©ë²• & ì´ìœ  ğŸ­

### 1) DB ëª¨ë¸ë§ ğŸ¤”

ì²˜ìŒì—ëŠ” í…Œì´ë¸”ì„ ë‘ê°œë§Œ ë‘ì–´ `User`ì™€, `Userê°€ ê°€ì§„ ìë™ì°¨ì™€ ê·¸ì— ë”°ë¥¸ íƒ€ì´ì–´ ì •ë³´`ë¥¼ í•œ í…Œì´ë¸”ì— ì €ì¥í•˜ë ¤ê³  í–ˆìœ¼ë‚˜, trimIdê°€ ë™ì¼í•œ ìë™ì°¨ëŠ” íƒ€ì´ì–´ ì •ë³´ê°€ ê°™ìœ¼ë¯€ë¡œ, Cars í…Œì´ë¸”ë¡œ ë§Œë“¤ì–´ ë™ì¼í•œ ì»¬ëŸ¼ë“¤ì˜ ì¤‘ë³µ ì €ì¥ì„ ì¤„ì´ê³ ì í–ˆìŠµë‹ˆë‹¤. 

- Users

  - passwordë¥¼ bcryptë¡œ ì•”í˜¸í™”í•œ í›„ ì €ì¥í•˜ê¸° ë•Œë¬¸ì— ê¸¸ì´ë¥¼ 200ìœ¼ë¡œ ë„‰ë„‰í•˜ê²Œ ì£¼ì—ˆìŠµë‹ˆë‹¤.

- OwnedLists

  - í•œ userê°€ ë™ì¼í•œ trimIdì˜ ì°¨ëŸ‰ì„ ì—¬ëŸ¬ê°œ ë“±ë¡í•  ìˆ˜ ì—†ë„ë¡,  `id` + `trimId` ì»¬ëŸ¼ì„ ë¬¶ì–´ Uniqueì†ì„±ì„ ë¶€ì—¬í•˜ì˜€ìŠµë‹ˆë‹¤.

    ```typescript
    @Unique(["user", "car"])
    ```

  - ë§Œì•½, í•œ userê°€ ë™ì¼í•œ trimIdì˜ ì°¨ëŸ‰ì„ ì¤‘ë³µìœ¼ë¡œ ë“±ë¡í•  ìˆ˜ ìˆê²Œ í•˜ë ¤ë©´ ì´ Uniqueì†ì„±ì„ ì œê±°í•´ì£¼ë©´ ë©ë‹ˆë‹¤. 

- Cars

  - ì²˜ìŒì—ëŠ” `í­` , `í¸í‰ë¹„`, `íœ  ì‚¬ì´ì¦ˆ` ì»¬ëŸ¼ì„ ë‘ì–´ 
    - frontTireì •ë³´ê°€ ìˆìœ¼ë©´ ì €ì¥, ì—†ìœ¼ë©´ rearTireì •ë³´ë¡œ ì €ì¥í•˜ë ¤ê³  í–ˆìŠµë‹ˆë‹¤.
  - í•˜ì§€ë§Œ, frontTireì™€ rearTireì˜ ê·œê²©ì´ ë‹¤ë¥¸ ê²½ìš°ê°€ ìˆì„ ê²ƒìœ¼ë¡œ íŒë‹¨ë˜ì–´ frontTireì™€ rearTireì˜ ì •ë³´ë¥¼ ë”°ë¡œ ì €ì¥í•  ìˆ˜ ìˆë„ë¡ ì»¬ëŸ¼ì˜ ìˆ˜ë¥¼ ëŠ˜ë ¸ìŠµë‹ˆë‹¤. 
  - í•˜ì§€ë§Œ ì•„ë˜ì™€ ê°™ì´ rearTireì˜ ì •ë³´ê°€ ì—†ëŠ” caseë¥¼ ë°œê²¬í•˜ê²Œ ë˜ì–´, rearTireê´€ë ¨ ì»¬ëŸ¼ì— nullable ì†ì„±ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤.

  <img src="https://user-images.githubusercontent.com/43634786/143772000-6c72eb6b-1a7d-49ca-919a-615860eaca3a.png" alt="image" style="zoom: 80%;" />

</br>

### 2) ì¸ì¦ ğŸ¤

JWTë¥¼ ì´ìš©í•œ ë¡œê·¸ì¸ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. 

[Nestjs ê³µì‹ ë¬¸ì„œ](https://docs.nestjs.com/security/authentication)ë¥¼ ë”°ë¼ êµ¬í˜„í–ˆìœ¼ë©°, ê´€ë ¨ íŒŒì¼ì€ `src/domain/auth`ì•ˆì— ìˆìŠµë‹ˆë‹¤.

guardë¥¼ ë§Œë“¤ê³ , í•´ë‹¹ guardê°€ í•„ìš”í•œ ê³³ì—ì„œ `@UseGuard()`ë°ì½”ë ˆì´í„°ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³ , íšŒì›ê°€ì… APIì—ì„œ íšŒì›ê°€ì… ì„±ê³µì‹œì— ë°”ë¡œ access_tokenì„ ë°œê¸‰í•´ì£¼ì–´ íšŒì›ê°€ì… ì§í›„ ë”°ë¡œ ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šì•„ë„ ë˜ë„ë¡ í–ˆìŠµë‹ˆë‹¤. 

</br>

### 3) ì‚¬ìš©ìê°€ ì†Œìœ í•œ íƒ€ì´ì–´ ì •ë³´ë¥¼ ì €ì¥í•˜ëŠ” API ğŸš“

- ì—¬ëŸ¬ ì‚¬ìš©ìì— ëŒ€í•´ í•œ ë²ˆì— ìš”ì²­í•  ìˆ˜ ìˆëŠ” APIì´ì§€ë§Œ, ê³¼ì œ ì•ˆë‚´ í˜ì´ì§€ì— `ì´í›„ì˜ APIëŠ” ì¸ì¦ëœ ì‚¬ìš©ìë§Œ í˜¸ì¶œí•  ìˆ˜ ìˆë‹¤.`ë¼ëŠ” ë¬¸êµ¬ê°€ ìˆì—ˆê¸°ì— ì´ APIëŠ” ëˆ„ê°€ ë¡œê·¸ì¸ë˜ì–´ìˆëŠ”ì§€ëŠ” ì‹ ê²½ì“°ì§€ ì•Šì§€ë§Œ, ë¡œê·¸ì¸ì´ ë˜ì–´ìˆì–´ì•¼ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

- ì´ APIëŠ” Request bodyë¡œ `ì‚¬ìš©ì ì •ë³´` + `trimId` ìŒì„ ìµœëŒ€ 5ê°œ ê¹Œì§€ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  ê·¸ë˜ì„œ ì¼ë¶€ëŠ” ì„±ê³µí•˜ê³ , ì¼ë¶€ëŠ” ì‹¤íŒ¨í•œ ê²½ìš°ì— ì–´ë–»ê²Œ Responseë¥¼ ë³´ë‚´ì¤„ì§€ì— ëŒ€í•´ ê³ ë¯¼í–ˆìŠµë‹ˆë‹¤.

  1ê°œë¼ë„ ì‹¤íŒ¨í–ˆì„ ë•Œ Errorë¥¼ ë³´ë‚´ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì´ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤. ë”°ë¼ì„œ 1ê°œë¼ë„ ì„±ê³µí•˜ë©´ 200ìœ¼ë¡œ Responseë¥¼ ë³´ë‚´ë˜ ë©”ì„¸ì§€ë¡œ ì‹¤íŒ¨í•œ ê²½ìš°ë¥¼ ë‚˜íƒ€ë‚´ì£¼ì—ˆìŠµë‹ˆë‹¤.

#### [ì˜ˆì‹œ]

- **í•œ ê°œë¼ë„ ì„±ê³µ**í•œ ê²½ìš°

  200ê³¼ í•¨ê»˜ ë°°ì—´ì´ Responseëœë‹¤.

  ì„±ê³µí•œ ê²½ìš°ëŠ” ìƒì„±ëœ idì™€ trimIdìŒì´,

  ì‹¤íŒ¨í•œ ê²½ìš°ì—ëŠ” í•´ë‹¹ caseì— ëŒ€í•œ error messageê°€ ë“¤ì–´ìˆë‹¤.

  ```json
  [
      {
          "id": "bada1",
          "trimId": 5
      },
      "ì¤‘ë³µëœ ì •ë³´ì…ë‹ˆë‹¤.",
      "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” userì…ë‹ˆë‹¤."
  ]
  ```

  

- ì „ë¶€ ì‹¤íŒ¨í•œ ê²½ìš° 

  400ê³¼ í•¨ê»˜ ë©”ì„¸ì§€ê°€ ë°°ì—´í˜•íƒœë¡œ Responseëœë‹¤.

  ```json
  {
      "statusCode": 400,
      "message": [
          "ì¤‘ë³µëœ ì •ë³´ì…ë‹ˆë‹¤.",
          "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” userì…ë‹ˆë‹¤."
      ],
      "path": "/owned-lists"
  }
  ```

  

ë‹¤ë§Œ, **DTOê°€ í•œ ê°œë¼ë„ ì–´ê¸‹ë‚¬ì„ ë•Œ**ì—ëŠ” ë°”ë¡œ 400ì´ Responseë©ë‹ˆë‹¤.

```json
{
    "statusCode": 400,
    "message": [
        "list.1.id should not be empty",
        "list.1.id must be a string"
    ],
    "path": "/owned-lists"
}
```



### 4) ìë™ì°¨ ì •ë³´ ì¡°íšŒ APIì˜ ì‚¬ìš© ğŸï¸

#### [API í˜¸ì¶œ]

ìë™ì ì •ë³´ ì¡°íšŒ APIë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ axiosì˜ HttpServiceë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬ë˜ëŠ” APIí˜¸ì¶œì´ ì™„ë£Œë  ë•Œ ê¹Œì§€ ê¸°ë‹¤ë¦´ í•„ìš”ê°€ ìˆì—ˆëŠ”ë°, return typeì´ Promiseê°€ ì•„ë‹ˆë¼ Observableì´ì—ˆê¸° ë•Œë¬¸ì— ë°”ë¡œ awaitë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ rjaxì˜ [lastValueFrom](https://rxjs.dev/api/index/function/lastValueFrom) í•¨ìˆ˜ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” Observableë¥¼ Promiseë¡œ ë°”ê¿”ì£¼ë©° í•¨ìˆ˜ ì´ë¦„ì´ ëœ»í•˜ëŠ” ë°”ì™€ ê°™ê²Œ ë§ˆì§€ë§‰ valueë¥¼ returní•´ì¤ë‹ˆë‹¤. 

</br>

ë˜í•œ ì¤‘ë³µëœ trimIdì˜ APIë¥¼ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œí•˜ì§€ ì•Šë„ë¡, `Cars`í…Œì´ë¸”ì— í•´ë‹¹ trimIdê°€ ì €ì¥ë˜ì–´ìˆì„ ë•Œì—ëŠ”, APIë¥¼ ìƒˆë¡œ í˜¸ì¶œí•˜ì§€ ì•Šê³  `ownedLists`ë¥¼ ë°”ë¡œ insertí•´ì£¼ì—ˆìŠµë‹ˆë‹¤. 

![image](https://user-images.githubusercontent.com/43634786/143802880-7e6044c2-b2d9-4415-b2d3-4042281d0911.png)

</br>

#### [ì •ê·œì‹ ì´ìš©]

ë˜í•œ, frontTire/rearTire.valueì˜ í˜•íƒœê°€ `205/75R18`ì™€ ê°™ì´ í•˜ë‚˜ì˜ stringì•ˆì— í­, í¸í‰ë¹„, íœ  ì‚¬ì´ì¦ˆê°€ ëª¨ë‘ í¬í•¨ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤.

ì£¼ì–´ì§„ stringì„ `/`ì™€ `R`ë¡œ splití•´ì£¼ì–´ì•¼ í–ˆëŠ”ë°, ì •ê·œì‹ì„ ì‘ì„±í•˜ì—¬ í•œ ë²ˆì˜ splití•¨ìˆ˜ë¡œ [í­, í¸í‰ë¹„, íœ  ì‚¬ì´ì¦ˆ]ë¥¼ êµ¬í•  ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.

</br>

#### [nullable]

Cars ì—”í‹°í‹° ëª¨ë¸ë§ì—ì„œë„ ì„¤ëª…í•œ ë‚´ìš©ì´ì§€ë§Œ, 

frontTireì™€ rearTireì˜ ì •ë³´ë¥¼ ê°ê° ì €ì¥í•˜ëŠ”ë°, rearTireê°€ ì •ë³´ê°€ ì—†ëŠ” ê²½ìš°ê°€ ìˆê¸° ë•Œë¬¸ì—, ê·¸ëŸ° ê²½ìš°ì—ëŠ” nullì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë„ë¡ í•´ì£¼ì—ˆìŠµë‹ˆë‹¤.

frontTire, rearTire ëª¨ë‘ null â†’ error

ë‘˜ ì¤‘ì— í•˜ë‚˜ë§Œ null â†’ í†µê³¼ í›„ í•´ë‹¹ ì»¬ëŸ¼ê°’ì´ nullë¡œ ì €ì¥ë˜ë„ë¡ ì²˜ë¦¬

carServiceë‚´ì˜ ìë™ì°¨ ì •ë³´ ì¡°íšŒ APIë¥¼ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜  [ë§í¬](https://github.com/sally0226/assignment-7-cardoc/blob/d1e051150234d02ceef58eee1db71cf05a7b9cac/src/domain/cars/cars.service.ts#L24)

```typescript
async getCarInfo(trimId: number) {
    const url = `https://dev.mycar.cardoc.co.kr/v1/trim/${trimId}`;
    try {
        const responseData = await lastValueFrom(
            this.httpService
            .get(url)
            .pipe(map((response) => response.data?.spec?.driving))
        );
        const frontTire = responseData.frontTire?.value;
        const rearTire  = responseData.rearTire?.value;
        if (!frontTire && !rearTire) return null;
        const frontInfo = frontTire ? frontTire.split(/R|\//) : null;
        const rearInfo  = rearTire  ? rearTire.split(/R|\//)  : null;
        const result = await this.carsRepository.createOne(
            trimId, 
            frontInfo, 
            rearInfo
        );
        return result;
    } catch (error) {
        return null;
    }
}
```

</br>

### 5) HTTP Status Code â›³

ê° APIì˜ status codeëŠ” ê³¼ì œ ì•ˆë‚´ í˜ì´ì§€ì— ë”°ë¼ 

200, 400, 401, 500ìœ¼ë¡œ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤. 

400ì˜ ê²½ìš°, errorì˜ ì´ìœ ê°€ ë‹¤ì–‘í•˜ë¯€ë¡œ error messageë¥¼ ë‹¤ë¥´ê²Œ ë„£ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤. 

ex) íšŒì›ê°€ì… ì‹œ ì¤‘ë³µ ê°€ì…ì˜ ê²½ìš°, DTOê°€ ì•ˆ ë§ëŠ” ê²½ìš° ë“±..

```json
// ì¤‘ë³µ ê°€ì…ì‹œ
{
    "statusCode": 400,
    "message": "ì¤‘ë³µëœ idì…ë‹ˆë‹¤.",
    "path": "/users/signup"
}
```

```json
// DTOì™€ ë§ì§€ ì•Šì„ ë•Œ
{
    "statusCode": 400,
    "message": [
        "id should not be empty",
        "id must be a string"
    ],
    "path": "/users/signup"
}
```

</br>

### 6) Exception ì²˜ë¦¬ ğŸš«

ì „ì—­ìœ¼ë¡œ exceptionì„ ì²˜ë¦¬í•´ì£¼ê¸° ìœ„í•´ [Nestjs ê³µì‹ë¬¸ì„œ](https://docs.nestjs.com/exception-filters#exception-filters-1)ë¥¼ ì°¸ê³ í–ˆìŠµë‹ˆë‹¤. 

ì•„ë˜ì™€ ê°™ì´ `http-exception.filter.ts`ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.

```typescript
@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
	catch(exception: HttpException, host: ArgumentsHost) {
		const ctx = host.switchToHttp();
		const response = ctx.getResponse<Response>();
		const request = ctx.getRequest<Request>();
		const status = exception.getStatus();
		const message = exception.getResponse()["message"] || exception.message;
		response.status(status).json({
			statusCode: status,
			message,
			path: request.url
		});
	}
}
```

íŠ¹íˆ `message`ì— ê°’ì„ ë„£ì–´ì£¼ëŠ” ë¶€ë¶„ì„ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

ë³´í†µì˜ ê²½ìš°ì—ëŠ” `exception.message`ì— string í˜•íƒœì˜ messageê°€ ë“¤ì–´ìˆëŠ”ë°, 

DTOê´€ë ¨ errorì™€ ê°™ì´ **messageê°€ 1ê°œ ì´ìƒìœ¼ë¡œ ë°°ì—´ í˜•íƒœë¡œ ì¡´ì¬í• ë•Œ**,

 `exception.message` ì—ëŠ” BadRequest Exceptionì´ë¼ëŠ” ë©”ì„¸ì§€ë§Œ ë“¤ì–´ìˆê³ , 

ìì„¸í•œ ë©”ì„¸ì§€ë“¤ì€ `exception.getResponse()["message"]`ì— ì¡´ì¬í–ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. 

</br>

### 7) Dockerë¥¼ ì´ìš©í•œ ë°°í¬ ğŸ³

![image](https://user-images.githubusercontent.com/43634786/143778527-322aa184-4456-4b48-9fe7-089509384080.png)

#### [MySQL]

docker hubì—ì„œ latestë²„ì „ì˜ imageë¥¼ ë‹¤ìš´ë°›ì•„ ì»¨í…Œì´ë„ˆë¥¼ ìƒì„± ë° ì‹¤í–‰í–ˆìŠµë‹ˆë‹¤. 

</br>

#### [Nestjs ì„œë²„]

- v12ì˜ node imageë¥¼ ì´ìš©í•˜ì˜€ìŠµë‹ˆë‹¤.. 

- ì•ˆì •ì ì¸ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ì„ ìœ„í•´ pm2ë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤
  - ê·¸ëƒ¥ pm2ê°€ ì•„ë‹Œ ë„ì»¤ì— ì í•©í•œ pm2-runtime ëª…ë ¹ì–´ë¥¼ ì´ìš©í–ˆìŠµë‹ˆë‹¤.
- `--output` optionì„ ì´ìš©í•´, íŠ¹ì • ìœ„ì¹˜ì— logíŒŒì¼ì´ ìƒê¸¸ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤. 

ìµœì¢…ì ìœ¼ë¡œ, ì•„ë˜ì™€ ê°™ì€ `Dockerfile`ì„ ì‘ì„±í•˜ì—¬ ì´ìš©í–ˆìŠµë‹ˆë‹¤.

```dockerfile
From node:12

# ì•± ë””ë ‰í† ë¦¬ ìƒì„±
WORKDIR /usr/src/app

COPY package*.json /usr/src/app/
RUN npm install
RUN npm install -g pm2
COPY . /usr/src/app/

RUN npm run build

EXPOSE 3000

CMD ["pm2-runtime", "start", "dist/main.js", "-i", "max", "--output", "/home/contents/log/main_out.log"]

# í™˜ê²½ë³€ìˆ˜ ì„¤ì •

# DATABASE
ENV MYSQL_HOST ...
ENV MYSQL_USERNAME ...
ENV MYSQL_PASSWORD ...
ENV MYSQL_DATABASE ...

# JWT
ENV JWT_SECRET_KEY ...
```


dockerë¥¼ ì§ì ‘ buildí•´ì„œ ì´ìš©í•´ ë³¸ ê²ƒì€ ì²˜ìŒì´ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ ë§ì€ ì‹œí–‰ì°©ì˜¤ë¥¼ ê²ªì—ˆì§€ë§Œ, ë‹¤ì–‘í•œ ìë£Œë¥¼ ì°¾ì•„ë³´ë©° ì„±ê³µí•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

1. `COPY . .`ì•ˆë˜ëŠ” ë¬¸ì œ

   `WORKDIR` ëª…ë ¹ì–´ë¡œ í´ë”ë¥¼ ì§€ì •í•´ì¤€ í›„, `COPY . .`ë¥¼ í•´ì£¼ë©´ í•´ë‹¹ í´ë”ì— ì¹´í”¼ê°€ ë˜ëŠ” ì¤„ ì•Œì•˜ëŠ”ë°, ë˜ì§€ ì•Šì•„ì„œ . ëŒ€ì‹ ì— ì ˆëŒ€ê²½ë¡œë¥¼ ì ì–´ì£¼ì—ˆìŠµë‹ˆë‹¤.

2. pm2 ì‹¤í–‰ í›„ logë¥¼ í™•ì¸í•  ìˆ˜ ì—†ë˜ ë¬¸ì œ

   `pm2-runtime`ìœ¼ë¡œ ì‹¤í–‰í•˜ë‹ˆ defalutë¡œ clustorê°€ 2ê°œ ìƒì„±ë˜ì–´ì„œ ê·¸ëŸ°ì§€ `pm2 logs [ì´ë¦„]`ìœ¼ë¡œ logë¥¼ í™•ì¸í•  ìˆ˜ê°€ ì—†ì—ˆìŠµë‹ˆë‹¤. 

   `pm2 monit`ì„ ì´ìš©í•´ ì‹¤ì‹œê°„ìœ¼ë¡œ ìƒê¸°ëŠ” logë¥¼ í™•ì¸í•  ìˆ˜ëŠ” ìˆì—ˆì§€ë§Œ, ì´ì „ì— ìƒì„±ëœ logë“¤ì„ í™•ì¸í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤. 

   ë”°ë¼ì„œ, `pm2-rumtime` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•  ë•Œ `--output`ëª…ë ¹ì–´ë¡œ logê²½ë¡œë¥¼ ì§€ì •í–ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ í•˜ë‹ˆ í•´ë‹¹ ê²½ë¡œì— logíŒŒì¼ì´ ìƒê²¨ì„œ ì§€ë‚œ logë“¤ì„ ì •ìƒì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 

</br>

## í´ë” êµ¬ì¡° ğŸ“‚

```
ğŸ“š src
â”œâ”€â”€ ğŸ“— common
â”‚  â”œâ”€â”€ ğŸ“‚ dto
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ createList.dto.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ createUser.dto.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ ListElement.dto.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ loginUser.dto.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ responseList.dto.ts
â”‚  â”œâ”€â”€ ğŸ“‚ filter
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ http-exception.filter.ts
â”œâ”€â”€ ğŸ“˜ domain 
â”‚  â”œâ”€â”€ ğŸ“‚ auth
â”‚  â”‚  â”œâ”€â”€ ğŸ“‚ guards
â”‚  â”‚  â”‚  â”œâ”€â”€ ğŸ“„ jwt-auth.guard.ts
â”‚  â”‚  â”‚  â”œâ”€â”€ ğŸ“„ local-auth.guard.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ auth.module.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ auth.service.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ jwt.strategy.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ local.strategy.ts
â”‚  â”œâ”€â”€ ğŸ“‚ cars
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ cars.module.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ cars.service.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ cars.repository.ts
â”‚  â”œâ”€â”€ ğŸ“‚ owned-lists
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ owned-lists.controller.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ owned-lists.module.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ owned-lists.service.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ owned-lists.repository.ts
â”‚  â”œâ”€â”€ ğŸ“‚ users
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ users.controller.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ users.module.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ users.service.ts
â”‚  â”‚  â”œâ”€â”€ ğŸ“„ users.repository.ts
â”œâ”€â”€ ğŸ“• entities
â”‚  â”œâ”€â”€ ğŸ“„ cars.entity.ts
â”‚  â”œâ”€â”€ ğŸ“„ owned-lists.entity.ts
â”‚  â”œâ”€â”€ ğŸ“„ users.entity.ts
â”œâ”€â”€ ğŸ“„ app.module.ts
â”œâ”€â”€ ğŸ“„ main.ts
ğŸ“š test
â”œâ”€â”€ ğŸ“„ app.e2e-spec.ts
â””â”€â”€ ğŸ“„ jest-e2e.json
ğŸ“„ .env
ğŸ“„ nest-cli.json
ğŸ“„ package.json
ğŸ“„ package-lock.json
ğŸ“„ tsconfig.json
ğŸ“„ tsconfig.build.json
ğŸ“„ README.md
ğŸ³ .dockerigonre
ğŸ³ Dockerfile
```

</br>

## API Test (with Postman) ğŸ¾

#### [ì£¼ì†Œ]

[Postman ë§í¬](https://documenter.getpostman.com/view/15410333/UVJcjvyn)

</br>

#### [ë°©ë²•]

1. **ìœ„ì˜ ë§í¬ë¥¼ í´ë¦­í•˜ì—¬ Postmanìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.** 
2. **íšŒì›ê°€ì…, ë¡œê·¸ì¸ APIë¥¼ ì´ìš©í•˜ì—¬ íšŒì›ê°€ì… or ë¡œê·¸ì¸ì„ ì§„í–‰í•©ë‹ˆë‹¤.**

![image-20211129023517455](https://user-images.githubusercontent.com/43634786/143779430-70793e28-849e-40a3-96dc-838eed22289c.png)

![image-20211129023539912](https://user-images.githubusercontent.com/43634786/143779429-808ae732-8015-41dd-8f43-bb8cbdd3a546.png)

3. **ë‹¤ìŒ APIë“¤ì„ í…ŒìŠ¤íŠ¸í•˜ê¸° ì „ì—, 2ë²ˆì—ì„œ ì–»ì€ `access_token`ì„ `Authorization`ì— ë“±ë¡í•´ì¤ë‹ˆë‹¤.**

![image-20211129023832428](https://user-images.githubusercontent.com/43634786/143779428-dbd4ac0c-85db-48db-97b4-4967a9f64bae.png)

4. **`Authorization`ì— tokenë“±ë¡ í›„ ì‚¬ìš©ìì˜ ìë™ì°¨ ëª©ë¡ ì¶”ê°€ APIë¥¼ í…ŒìŠ¤íŠ¸í•´ë´…ë‹ˆë‹¤.**

![image-20211129023932715](https://user-images.githubusercontent.com/43634786/143779425-546f713c-1528-46ed-acfb-e616913f45f4.png)

5. **`Authorization`ì— tokenë“±ë¡ í›„ ì‚¬ìš©ìì˜ ìë™ì°¨ ëª©ë¡ ì¡°íšŒ APIë¥¼ í…ŒìŠ¤íŠ¸í•´ë´…ë‹ˆë‹¤.** 

![image-20211129024017155](https://user-images.githubusercontent.com/43634786/143779423-78c82347-f22d-43ee-b5ad-14c85ae15ca0.png)

